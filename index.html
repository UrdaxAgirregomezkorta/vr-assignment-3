<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VR Media Viewer - Hand Tracking</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.5.x/dist/aframe-environment-component.min.js"></script>
    <script>
      // Component for hand-interactive buttons
      AFRAME.registerComponent("hand-button", {
        schema: {
          src: { type: "string" },
          mediaType: { type: "string", default: "image" }
        },
        init: function () {
          const el = this.el;
          const data = this.data;
          let isActive = false;
          let isHovered = false;

          // Hover detection
          el.addEventListener("mouseenter", () => {
            if (!isActive && !isHovered) {
              isHovered = true;
              el.setAttribute("scale", "1.15 1.15 1.15");
              el.setAttribute("material", "emissive", "#444");
            }
          });

          el.addEventListener("mouseleave", () => {
            if (!isActive && isHovered) {
              isHovered = false;
              el.setAttribute("scale", "1 1 1");
              el.setAttribute("material", "emissive", "#000");
            }
          });

          // Click/Pinch detection
          el.addEventListener("click", () => {
            // Reset all buttons
            document.querySelectorAll('.media-btn').forEach(btn => {
              btn.setAttribute("material", "emissive", "#000");
              btn.setAttribute("scale", "1 1 1");
              if (btn.components['hand-button']) {
                btn.components['hand-button'].isActive = false;
              }
            });

            // Activate this button
            isActive = true;
            isHovered = false;
            el.setAttribute("material", "emissive", "#FFD700");
            el.setAttribute("scale", "1 1 1");

            // Update main screen
            const screen = document.querySelector("#media-screen");
            screen.removeAttribute("material");
            setTimeout(() => {
              screen.setAttribute("material", {
                src: data.src,
                shader: "flat",
                side: "double"
              });
            }, 50);
          });

          // Store state
          this.isActive = isActive;
        }
      });

      // Component for pinch gestures
      AFRAME.registerComponent("pinchable", {
        init: function () {
          const el = this.el;
          let isPinching = false;

          el.addEventListener("pinchstarted", (evt) => {
            isPinching = true;
            el.emit("click");
          });

          el.addEventListener("pinchended", () => {
            isPinching = false;
          });
        }
      });
    </script>
  </head>

  <body>
    <a-scene environment="preset: starry; lighting: none">
      <!-- Enhanced Lighting -->
      <a-light type="ambient" intensity="0.6" color="#FFF"></a-light>
      <a-light type="directional" position="2 4 1" intensity="0.8" color="#FFF"></a-light>
      <a-light type="point" position="0 3 0" intensity="0.5" color="#FFD700"></a-light>

      <!-- Camera Rig -->
      <a-entity id="rig" position="0 1.6 3">
        <a-entity camera look-controls wasd-controls>
          <!-- Desktop cursor -->
          <a-cursor
            color="#FFD700"
            raycaster="objects: .clickable"
            fuse="false"
          ></a-cursor>
          
          <!-- VR Controllers -->
          <a-entity
            laser-controls="hand: right"
            raycaster="objects: .clickable; far: 10"
            line="color: #FFD700; opacity: 0.75"
          ></a-entity>
          
          <a-entity
            laser-controls="hand: left"
            raycaster="objects: .clickable; far: 10"
            line="color: #FFD700; opacity: 0.75"
          ></a-entity>
        </a-entity>
      </a-entity>

      <!-- Hand Tracking (Quest 3 compatible) -->
      <a-entity 
        hand-tracking-controls="hand: left; modelColor: #FFD700"
        sphere-collider="objects: .clickable"
      ></a-entity>
      
      <a-entity 
        hand-tracking-controls="hand: right; modelColor: #FFD700"
        sphere-collider="objects: .clickable"
      ></a-entity>

      <!-- Title -->
      <a-text
        value="VR MEDIA GALLERY"
        position="0 4.5 -5"
        align="center"
        width="8"
        color="#FFD700"
        font="roboto"
        shader="msdf"
      ></a-text>

      <!-- Main Display Screen -->
      <a-entity position="0 3 -5">
        <!-- Frame -->
        <a-box
          width="6.3"
          height="3.8"
          depth="0.15"
          color="#0a0a0a"
          position="0 0 -0.08"
          material="metalness: 0.8; roughness: 0.2"
        ></a-box>
        
        <!-- Inner frame glow -->
        <a-box
          width="6.1"
          height="3.6"
          depth="0.1"
          color="#1a1a1a"
          position="0 0 -0.05"
          material="emissive: #FFD700; emissiveIntensity: 0.2"
        ></a-box>
        
        <!-- Screen -->
        <a-plane
          id="media-screen"
          width="6"
          height="3.5"
          material="src: #img1; shader: flat"
        ></a-plane>
      </a-entity>

      <!-- Media Assets -->
      <a-assets>
        <img id="img1" src="https://cdn.aframe.io/a-painter/images/floor.jpg" crossorigin="anonymous" />
        <img id="img2" src="https://cdn.aframe.io/a-painter/images/sky.jpg" crossorigin="anonymous" />
        <img id="img3" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/city.jpg" crossorigin="anonymous" />
        <img id="img4" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/cubes.jpg" crossorigin="anonymous" />
      </a-assets>

      <!-- Control Panel -->
      <a-entity position="0 1.5 -2.5">
        <!-- Panel background -->
        <a-plane
          position="0 0 -0.3"
          width="7.5"
          height="2"
          color="#0f0f1e"
          opacity="0.7"
          material="metalness: 0.5; roughness: 0.8"
        ></a-plane>

        <!-- Button 1 -->
        <a-box
          class="clickable media-btn"
          position="-2.5 0 0"
          width="1.2"
          height="1.2"
          depth="0.2"
          src="#img1"
          material="color: #fff; metalness: 0.3; roughness: 0.7"
          hand-button="src: https://cdn.aframe.io/a-painter/images/floor.jpg"
          pinchable
          shadow="cast: true"
        >
          <a-text
            value="TEXTURE 1"
            align="center"
            color="#FFD700"
            width="3"
            position="0 -0.85 0.15"
          ></a-text>
        </a-box>

        <!-- Button 2 -->
        <a-box
          class="clickable media-btn"
          position="-0.8 0 0"
          width="1.2"
          height="1.2"
          depth="0.2"
          src="#img2"
          material="color: #fff; metalness: 0.3; roughness: 0.7"
          hand-button="src: https://cdn.aframe.io/a-painter/images/sky.jpg"
          pinchable
          shadow="cast: true"
        >
          <a-text
            value="TEXTURE 2"
            align="center"
            color="#FFD700"
            width="3"
            position="0 -0.85 0.15"
          ></a-text>
        </a-box>

        <!-- Button 3 -->
        <a-box
          class="clickable media-btn"
          position="0.8 0 0"
          width="1.2"
          height="1.2"
          depth="0.2"
          src="#img3"
          material="color: #fff; metalness: 0.3; roughness: 0.7"
          hand-button="src: https://cdn.aframe.io/360-image-gallery-boilerplate/img/city.jpg"
          pinchable
          shadow="cast: true"
        >
          <a-text
            value="CITY"
            align="center"
            color="#FFD700"
            width="3"
            position="0 -0.85 0.15"
          ></a-text>
        </a-box>

        <!-- Button 4 -->
        <a-box
          class="clickable media-btn"
          position="2.5 0 0"
          width="1.2"
          height="1.2"
          depth="0.2"
          src="#img4"
          material="color: #fff; metalness: 0.3; roughness: 0.7"
          hand-button="src: https://cdn.aframe.io/360-image-gallery-boilerplate/img/cubes.jpg"
          pinchable
          shadow="cast: true"
        >
          <a-text
            value="CUBES"
            align="center"
            color="#FFD700"
            width="3"
            position="0 -0.85 0.15"
          ></a-text>
        </a-box>
      </a-entity>

      <!-- Instructions -->
      <a-text
        value="Use hand gestures to pinch or point at thumbnails â€¢ Works with Quest hand tracking"
        position="0 0.3 -2.5"
        align="center"
        width="6"
        color="#999"
      ></a-text>

      <!-- VR Mode indicator -->
      <a-text
        value="Hand Tracking Active"
        position="0 4.2 -5"
        align="center"
        width="5"
        color="#4CAF50"
      ></a-text>
    </a-scene>
  </body>
</html>